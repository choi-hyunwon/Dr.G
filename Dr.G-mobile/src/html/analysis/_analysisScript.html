<script>
  $(document).ready(function () {
    // chatbot
    var chatbot = $('#chatbot');

    chatbot.draggable({
      containment: 'parent',
      axis: 'y',
      drag: function () {
        var offset = $(this).offset();
        var yPos = offset.top;
        console.log('y :', yPos)
      }
    });

    chatbot.find('img').on('click',function (){
      $(this).siblings('.tip').show();
    })

    $('._chatClose').on('click',function (){
      chatbot.children('.tip').hide();
    })

    // 질문 클릭 시
    let answer = $('.question-box .answer')
    let list = answer.find('li');
    answer.each(function () {
      list.on('click', function () {
        $(this).siblings().hide()
        $(this).parents('.answer').addClass('complete')
      })

      $('.delete').on('click', function () {
        $(this).parent().removeClass('complete')
        $(this).parent().find('li').show()
      })
    })
    if (answer.hasClass('complete')) {
      list.hide();
    } else {
      list.show()
    }

    /*수정요청입력란*/
    let badge = $('.write-area .badge-box .badge')
    badge.on('click', function () {
      $(this).siblings().removeClass('active')
      $(this).addClass('active')
    })



/*-------------s 분석결과 상세 (스킨케어,헤어제품)-----------------*/

    /*gauge bar*/
    let progress = 0.5
    $('#progress').find('.numerical').animate({'stroke-dashoffset': 150 * progress}, 1000)
    /*gauge number*/
    let counterUp = setInterval(function () {
      let text = $('.percent .counter');
      let gaugeText = text.html();
      let counter = parseInt(gaugeText);

      if (counter !== 50) {
        text.html(counter + 1);
      } else {
        clearInterval(counterUp);
      }
    }, 20);


    /*- 제품버전 보기-*/
    let name = $('.section-product .name')
    let btnVersion = $('.section-product .name .btn_version')
    btnVersion.on('click', function () {
      name.toggleClass('show')
    })

    /*전성분 보기*/
    let product = $('.section-product')
    let btnFold = $('.section-product .desc .btn-wrap .btn-fold')
    let btnView = $('.section-product .view .btn-view')
    btnView.on('click', function () {
      product.addClass('open')
    })
    btnFold.on('click', function () {
      product.removeClass('open')
    })



    /*--- s 매칭된 성분 확인 ---*/

    let infoList = $('._know .info-list')
    let subTitle = $('._know .sub-title')
    let mixing = $('._know .mixing')
    let mixingLi = $('._know .mixing li')
    let btnMore = $('._know .mixing li .btn-more')

    $(function (){
      infoList.find('.mixing li:not(:last)').hide();

      if(infoList.hasClass('open')){
        $(this).find(mixingLi).slice(0, 3).show();
        $(this).next('.mixing').children(btnMore).text('더보기')
      }
    })

    subTitle.on('click', function () {
      $(this).parent().toggleClass('open')
      $(this).next().removeClass('more').find('li').slice(3).hide().last().show().find('.btn-more').text('더보기');
      $(this).next().removeClass('more').find('li').slice(0, 3).show();
    })

    btnMore.on('click', function () {
      if ($(this).parents('.mixing').hasClass('more')) {
        $(this).text('더보기'); //닫혀있는 상태 (3개)
        $(this).parents('.mixing').removeClass('more').find('li:not(:last)').hide();
        $(this).parents('.mixing').removeClass('more').find('li').slice(0, 3).show();
      } else {
        $(this).text('닫기');  //더보기 상태 (3개 이상)
        $(this).parents('.mixing').addClass('more').find('li').show();
      }
    })

    /*--- e 매칭된 성분 확인 ---*/



    /*faq*/
    let faqList = $('.faq-list')
    let item = $('.faq-list .item')
    let solution = $('.solution')
    item.on('click', function () {
      if (!$(this).hasClass('active')) {
        $(this).siblings().removeClass('active')
        $(this).siblings().find(solution).slideUp(200);
        $(this).addClass('active');
        $(this).find(solution).slideDown(200);
      } else {
        $(this).removeClass('active');
        $(this).find(solution).slideUp(200);
      }
    })
    $('body').click(function(e) { /*외부클릭시 닫힘처리*/
      if(!faqList.has(e.target).length){
        item.removeClass('active');
        item.find('.solution').slideUp(200);
      }
    });

/*-------------e 분석결과 상세 (스킨케어,헤어제품)-----------------*/


    /*서브메인*/
    /*gauge number*/
    let mainCounter = setInterval(function () {
      let text = $('._sub-main .img-box .percent .counter');
      let gaugeText = text.html();
      let counter = parseInt(gaugeText);

      if (counter !== 74) {
        text.html(counter + 1);
      } else {
        clearInterval(mainCounter);
      }
    }, 20);
  });


  /*tab*/
  let sectionTab = $('._section-tab');
   let lastScroll = 0;
  $(window).scroll(function (){
    if($('.container').find('._sub-main').length){
      let st = $(this).scrollTop();
      //console.log(st);
      let sectionTabOffset = $('._section-tab').position ().top;
      let sectionAbout = $('.section-about').position ().top;

      if (st > lastScroll){
        //console.log("DOWN");
        if (window.pageYOffset > sectionTabOffset) {
          // sectionTab.hide();
          sectionTab.addClass('fixed').addClass('top_0');
        }
      }
      else {
        //console.log("UP");
        if (window.pageYOffset >= sectionTabOffset) {
          sectionTab.addClass('fixed').removeClass('top_0');
          if (window.pageYOffset < sectionAbout) {
            sectionTab.removeClass('fixed')
          }
        }
      }
      //Updates scroll position
      lastScroll = st;



      /* 탭활성화 */
      let section = $('.section')
      let tab = $('._section-tab .item')
      section.each(function( index, element ) {
        // console.log( section.eq(index));
        if ( st > $(this).offset().top - 350){
          tab.removeClass('active')
          tab.eq(index).addClass('active')
        }
      });

    }
  });
  $('.slide-tab .item a').on('click',function (){
    let idx = $(this).parent().index()
    console.log(idx)
    let offset = $('.section').eq(idx).offset();
    let headHeight = $('.header-white').height() + $('._tab').height()

    if ($('.header-white').hasClass('header-transparent')){
      $('html, body').animate({scrollTop : offset.top - headHeight},400)
    }else {
      $('html, body').animate({scrollTop : offset.top},400)
    }

  })






  /*서브메인 what*/
  let stepSwiper = new Swiper ('.step-swiper', {
    loop: true,
    speed: 800,
    autoplay : {  // 자동 슬라이드 설정 , 비 활성화 시 false
      delay : 4000,   // 시간 설정
    },
    slidesPerView: 3,/*보여지는 갯수*/
    centeredSlides: true, /*가운데 정렬*/
    allowTouchMove: false, /*터치금지*/
    initialSlide: 1, /*시작 슬라이드*/
  //  spaceBetween:20
  })


  let whatSwiper = new Swiper('._whatSwiper', {
    effect: 'slide',
    autoplay: {
      enabled: false,
      delay: 3000,
    },
    speed: 1000,
    pagination: {
      el: "._whatPagination"
    },

  });

  new Waypoint({
    element: document.querySelector('._whatSwiper'),
    handler: function () {
      whatSwiper.autoplay.start();
      //console.log('_whatSwiper')
    },
    offset: "50%"
  })

  let whatAni1 = document.querySelector('._whatAni1');
  let whatStep1 = bodymovin.loadAnimation({
    container: whatAni1,
    renderer: 'svg',
    loop: false,
    autoplay: true,
    path: "../../img/analysis/img-main-what-slide1.json"
  });

  let whatAni2 = document.querySelector('._whatAni2');
  let whatStep2 = bodymovin.loadAnimation({
    container: whatAni2,
    renderer: 'svg',
    loop: true,
    autoplay: true,
    path: "../../img/analysis/img-main-what-slide2.json"
  });

  whatSwiper.on('slideChange', function () {
    let idx = whatSwiper.realIndex + 1
    //console.log(idx);
    $('.step-box .step').removeClass('active')
    $('.step-box .step').eq(idx).addClass('active')


    if (whatSwiper.realIndex === 0) {
      whatStep1.playSegments([0, 104], true)

    } else if (processSwiper.realIndex === 1) {
      whatStep2.playSegments([0, 79], true)
    }
  });



  /*서브메인 process*/
  let processSwiper = new Swiper("._processSwiper", {
    effect: 'slide',
    autoplay: {
      enabled: false,
      delay: 3000,
    },
    speed: 1000,
    pagination: {
      el: "._whatPagination",
      clickable: true,
    },
  });

  new Waypoint({
    element: document.querySelector('._processSwiper'),
    handler: function () {
      processSwiper.autoplay.start();
      //console.log('_processSwiper')
    },
    offset: "50%"
  })

  let processAni1 = document.querySelector('._processAni1');
  let processStep1 = bodymovin.loadAnimation({
    container: processAni1,
    renderer: 'svg',
    loop: false,
    autoplay: true,
    path: "../../img/mentoring/progress-step1.json"
  });

  let processAni2 = document.querySelector('._processAni2');
  let processStep2 = bodymovin.loadAnimation({
    container: processAni2,
    renderer: 'svg',
    loop: false,
    autoplay: true,
    path: "../../img/analysis/progress-step2.json"
  });

  let processAni3 = document.querySelector('._processAni3');
  let processStep3 = bodymovin.loadAnimation({
    container: processAni3,
    renderer: 'svg',
    loop: false,
    autoplay: true,
    path: "../../img/mentoring/progress-step3.json"
  });

  processSwiper.on('slideChange', function () {

    let stepLi = $('.analysis-sub-main .step-box li')

    if (processSwiper.realIndex === 0) {
      processStep1.playSegments([0, 180], true)
      $('._stepBox').find('.step').eq(0).addClass('active').siblings().removeClass('active');
      stepLi.removeClass('active check bar')
      stepLi.eq(0).addClass('active')

    } else if (processSwiper.realIndex === 1) {
      processStep2.playSegments([11, 69], true)
      $('._stepBox').find('.step').eq(1).addClass('active').siblings().removeClass('active');
      stepLi.eq(0).removeClass('active')
      stepLi.eq(1).addClass('active bar')
      stepLi.eq(2).removeClass('active')

    } else if (processSwiper.realIndex === 2) {
      processStep3.playSegments([0, 240], true)
      $('._stepBox').find('.step').eq(2).addClass('active').siblings().removeClass('active');
      stepLi.eq(0).removeClass('active')
      stepLi.eq(1).removeClass('active').addClass('check bar')
      stepLi.eq(2).addClass('active bar')
    }
  });




  /*서브메인 voc*/
  $('.voc .review_box .item').on('click', function () {
    if (!$(this).hasClass('active')) {
      $(this).addClass('active').slideDown();
      $(this).siblings().removeClass('active');
    } else {
      $(this).removeClass('active');
    }
  })

  /*서브메인 faq*/
  let box = $('.faq_box')
  let item = $('.faq_box .item')
  let solution = $('.solution')
  item.on('click', function () {
    if (!$(this).hasClass('active')) {
      $(this).siblings().removeClass('active')
      $(this).siblings().find(solution).slideUp(200);
      $(this).addClass('active');
      $(this).find(solution).slideDown(200);
    } else {
      $(this).removeClass('active');
      $(this).find(solution).slideUp(200);
    }
  })
  $('body').click(function(e) { /*외부클릭시 닫힘처리*/
    if(!box.has(e.target).length){
      item.removeClass('active');
      item.find('.solution').slideUp(200);
    }
  });
  </script>
