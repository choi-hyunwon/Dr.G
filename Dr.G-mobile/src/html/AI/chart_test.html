<!DOCTYPE html>
<html lang="ko">
@@include('../../html/include/common/head.html')
<!--<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js" integrity="sha256-xH4q8N0pEzrZMaRmd7gQVcTZiFei+HfRTBPJ1OGXC0k=" crossorigin="anonymous"></script>-->
<script src="//cdn.amcharts.com/lib/4/core.js"></script>
<script src="//cdn.amcharts.com/lib/4/charts.js"></script>
<script src="//cdn.amcharts.com/lib/4/themes/animated.js"></script>
<!--<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>
<!--<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>-->
<body>
<div class="wrap">
    <!-- s header -->
    <!--    @@include('../../html/include/common/header.html')-->
    <!-- e header -->

    <!-- s contents -->
    <div class="container">
        <div class="AI-wrap">

            <!-- amcharts.js -->
            <div class="chart-box" id="chartWrapper">
                <div class="chart-grid"></div>
                <div id="handler">
                    <div id="chart" class="chart"></div>
                </div>
            </div>
            <!--
                남은 사항
                 ☐ 툴팁 내 font-family가 적용된 폰트 사이즈를 인식하지 못함 -> 잘림 이슈 발생
                 ☐ 그라데이션 라인으로 컨펌날 경우 / gradient line chart
                 ☐ y축 0 ~ 20점일 경우 / 라벨 & tooltip 상단으로 이동
                 ☐ 화면 크기에 따라 resize (vw 처리)
                 ☐ 슬라이딩 이벤트 처리 (기획 확인 필요)
                 ☐ 2021-09-01 / 1일을 기준으로 x축 값 노출
            -->
        </div>
    </div>
    <!-- e contents -->

    <!-- s footer -->
    <!--    @@include('../../html/include/common/footer.html')-->
    <!-- e footer -->
</div>
<script>
    // animation
    am4core.useTheme(am4themes_animated);
    var chart = am4core.create("chart", am4charts.XYChart);
    chart.data = [
        {
            "date": "2021-8-1",
            "value": 90,
            "type": ' OS+\n' + '민지형',
        },
        {
            "date": "2021-9-1",
            "value": 0,
            "type": ' OS+\n' + '민지형',
        },
        {
            "date": "2021-10-1",
            "value": 100,
            "type": ' OS+\n' + '민지형',
        },
        {
            "date": "2021-11-1",
            "value": 30,
            "type": ' OS+\n' + '민지형',
        },
        {
            "date": "2021-12-1",
            "value": 60,
            "type": ' OS+\n' + '민지형',
        },
    ];

    chart.paddingTop = 59;
    chart.paddingBottom = 76;
    chart.paddingLeft = 0;
    chart.paddingRight = 0;
    chart.autoMargins= false;

    // y축 생성
    var dateAxis = chart.xAxes.push(new am4charts.CategoryAxis());
    dateAxis.dataFields.category = "date";
    dateAxis.startLocation = 0.0001;
    dateAxis.endLocation = 1;
    dateAxis.renderer.minLabelPosition = 0.05;
    dateAxis.renderer.maxLabelPosition = 0.95;
    dateAxis.renderer.minGridDistance = 30;

    // x축 생성
    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    valueAxis.min = 0;
    valueAxis.max = 100;
    valueAxis.renderer.minGridDistance = 25;
    valueAxis.renderer.minLabelPosition = 2; // y축 라벨 숨기기

    // dateAxis.renderer.grid.template.disabled = true;
    // valueAxis.renderer.grid.template.disabled = true;

    // line custom
    var series = chart.series.push(new am4charts.LineSeries());
    series.dataFields.valueY = "value";
    series.dataFields.categoryX = "date";
    series.strokeWidth = 6;
    series.tensionX = 0.7;

    // gradient line
    var gradient = new am4core.LinearGradient();
    gradient.stops.push({color:am4core.color("#FFE665")})
    gradient.stops.push({color:am4core.color("#47BDFF")})
    series.stroke = gradient;

    // tooltip
    var circleBullet = series.bullets.push(new am4charts.CircleBullet());
    circleBullet.tooltipHTML = `<a href="#" class="number">{value}</a>`;
    circleBullet.showTooltipOn = "always";
    series.tooltip.label.interactionsEnabled = true;
    series.tooltip.keepTargetHover = true;
    chart.tooltip.getFillFromObject = false;
    series.tooltip.pointerOrientation = "down";
    // series.tooltip.background.fill = am4core.color("red");
    // series.tooltip.label.fill = am4core.color("red");


    // tooltip round
    series.tooltip.background.cornerRadius = 100;
    series.tooltip.background.strokeOpacity = 0;
    series.tooltip.label.minWidth = 36;
    series.tooltip.label.minHeight = 30;
    series.tooltip.label.textAlign = "middle";
    series.tooltip.label.textValign = "middle";

    // tooltip shadow
    var shadow = series.tooltip.background.filters.getIndex(0);
    shadow.dx = 4;
    shadow.dy = 8;
    shadow.blur = 12;
    shadow.opacity = 0.12;
    shadow.color = am4core.color("#222");

    // bullet
    var bullet = series.bullets.push(new am4charts.CircleBullet());
    bullet.circle.fill = am4core.color("#2FCAB0");
    bullet.circle.stroke = am4core.color("#fff");
    bullet.circle.strokeWidth = 4;

    // bullet text
    var labelBullet = series.bullets.push(new am4charts.LabelBullet());
    labelBullet.label.text = "{type}";
    labelBullet.label.align = "center";
    labelBullet.label.valign = "middle";
    console.log(labelBullet)

    // 20 아래일 경우, 텍스트 위치 조정
    labelBullet.adapter.add("dy", function(dy, target) {
        var value = target.dataItem._dataContext.value
        if (value <= 20) {
            return value === 0 ? dy - 65 : dy - (50 + value);
        }
        return dy + 30;
    });
</script>
</body>
</html>
